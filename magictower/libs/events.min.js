function events(){}
events.prototype.init=function(){this.events={battle:function(a,b,c){b.battle(a.event.id,a.x,a.y);b.isset(c)&&c()},getItem:function(a,b,c){b.getItem(a.event.id,1,a.x,a.y);b.isset(c)&&c()},openDoor:function(a,b,c){b.openDoor(a.event.id,a.x,a.y,!0,function(){b.isset(c)&&c();b.replay()})},changeFloor:function(a,b,c){var d={};b.isset(a.event.data.loc)&&(d={x:a.event.data.loc[0],y:a.event.data.loc[1]});b.isset(a.event.data.direction)&&(d.direction=a.event.data.direction);b.changeFloor(a.event.data.floorId,a.event.data.stair,
d,a.event.data.time,function(){b.isset(c)&&c();b.replay()})},passNet:function(a,b,c){b.events.passNet(a);b.isset(c)&&c()},changeLight:function(a,b,c){b.events.changeLight(a.x,a.y);b.isset(c)&&c()},ski:function(a,b,c){b.events.ski();b.isset(c)&&c()},pushBox:function(a,b,c){b.events.pushBox(a);b.isset(c)&&c()},action:function(a,b,c){b.events.doEvents(a.event.data,a.x,a.y);b.isset(c)&&c()}}};events.prototype.getEvents=function(a){return core.isset(a)?this.events[a]:this.events};
main.instance.events=new events;
events.prototype.startGame=function(a){core.status.isStarting||(core.status.isStarting=!0,core.hideStartAnimate(function(){core.drawText(core.clone(core.firstData.startText),function(){core.flags.showBattleAnimateConfirm?(core.status.event.selection=core.flags.battleAnimate?0:1,core.ui.drawConfirmBox("\u4f60\u60f3\u5f00\u542f\u6218\u6597\u52a8\u753b\u5417\uff1f\n\u4e4b\u540e\u53ef\u4ee5\u5728\u83dc\u5355\u680f\u4e2d\u5f00\u542f\u6216\u5173\u95ed\u3002\n\uff08\u5f3a\u70c8\u5efa\u8bae\u65b0\u624b\u5f00\u542f\u6b64\u9879\uff09",function(){core.flags.battleAnimate=
!0;core.setLocalStorage("battleAnimate",!0);core.startGame(a);core.events.setInitData(a)},function(){core.flags.battleAnimate=!1;core.setLocalStorage("battleAnimate",!1);core.startGame(a);core.events.setInitData(a)})):(core.startGame(a),core.events.setInitData(a))})}))};events.prototype.setInitData=function(a){"Easy"==a&&core.setFlag("hard",1);"Normal"==a&&core.setFlag("hard",2);"Hard"==a&&core.setFlag("hard",3);this.afterLoadData()};
events.prototype.win=function(a){core.ui.closePanel();var b=core.status.replay.replaying;core.stopReplay();core.waitHeroToStop(function(){core.removeGlobalAnimate(0,0,!0);core.clearMap("all");core.drawText([200<=core.status.hero.lv?"\t[True End]\u4f60\u7684\u653b\u9632\u548c\u5206\u6570\u662f${status:hp}\u3002":"\t[Normal End]\u4f60\u7684\u653b\u9632\u548c\u5206\u6570\u662f${status:hp}\u3002\n\uff08\u53ea\u6709\u4e0d\u5c0f\u4e8e200\u7ea7\u624d\u80fd\u8fbe\u6210True End\uff09"],function(){core.events.gameOver(200<=
core.status.hero.lv?"True End":"Normal End",b)})})};events.prototype.lose=function(a){core.ui.closePanel();var b=core.status.replay.replaying;core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t[\u7ed3\u5c401]\u4f60\u6b7b\u4e86\u3002\n\u5982\u9898\u3002"],function(){core.events.gameOver(null,b)})})};
events.prototype.gameOver=function(a,b){var c=function(){if(core.isset(a)){var b=function(b){null==b&&(b="");var c=new FormData;c.append("type","score");c.append("name",core.firstData.name);c.append("version",core.firstData.version);c.append("platform",core.platform.isPC?"PC":core.platform.isAndroid?"Android":core.platform.isIOS?"iOS":"");c.append("hard",core.status.hard);c.append("username",b);c.append("ending",a);c.append("lv",core.status.hero.lv);c.append("hp",core.status.hero.hp);c.append("atk",
core.status.hero.atk);c.append("def",core.status.hero.def);c.append("mdef",core.status.hero.mdef);c.append("money",core.status.hero.money);c.append("experience",core.status.hero.experience);c.append("steps",core.status.hero.steps);c.append("route",core.encodeRoute(core.status.route));b=new XMLHttpRequest;b.open("POST","/games/upload.php");b.send(c);core.restart()};core.ui.drawConfirmBox("\u4f60\u60f3\u8bb0\u5f55\u4f60\u7684ID\u548c\u6210\u7ee9\u5417\uff1f",function(){b(prompt("\u8bf7\u8f93\u5165\u4f60\u7684ID\uff1a"))},
function(){b("")})}else core.restart()},d=function(){core.ui.closePanel();core.ui.drawConfirmBox("\u4f60\u60f3\u4e0b\u8f7d\u5f55\u50cf\u5417\uff1f",function(){var a={name:core.firstData.name,version:core.firstData.version,hard:core.status.hard,route:core.encodeRoute(core.status.route)};core.download(core.firstData.name+"_"+core.formatDate2(new Date)+".h5route",JSON.stringify(a));c()},function(){c()})};b?core.drawText("\u5f55\u50cf\u56de\u653e\u5b8c\u6bd5\uff01",function(){core.restart()}):d()};
events.prototype.afterChangeFloor=function(a){core.isset(core.status.event.id)||core.hasFlag("visited_"+a)||(this.doEvents(core.floors[a].firstArrive,null,null,function(){}),core.setFlag("visited_"+a,!0))};events.prototype.doEvents=function(a,b,c,d){core.isset(a)&&(a instanceof Array||(a=[a]),core.waitHeroToStop(function(){core.lockControl();core.status.event={id:"action",data:{list:core.clone(a),x:b,y:c,callback:d}};core.events.doAction()}))};
events.prototype.doAction=function(){core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);if(0==core.status.event.data.list.length)core.isset(core.status.event.data.callback)&&core.status.event.data.callback(),core.ui.closePanel(),core.replay();else{var a=core.status.event.data.list.shift();core.status.event.data.current=a;var b=core.status.event.data.x,c=core.status.event.data.y;if("string"==typeof a)core.status.event.data.type="text",core.status.replay.replaying?core.events.doAction():
core.ui.drawTextBox(a);else switch(core.status.event.data.type=a.type,a.type){case "text":core.status.replay.replaying?core.events.doAction():core.ui.drawTextBox(a.data);break;case "setText":if("up"==a.position||"down"==a.position||"center"==a.position)core.status.textAttribute.position=a.position;["background","title","text"].forEach(function(b){core.isset(a[b])&&a[b]instanceof Array&&3<=a[b].length&&(3==a[b].length&&a[b].push(1),core.status.textAttribute[b]=a[b])});core.events.doAction();break;
case "tip":core.drawTip(core.replaceText(a.text));core.events.doAction();break;case "show":"number"==typeof a.loc[0]&&"number"==typeof a.loc[1]&&(a.loc=[a.loc]);core.isset(a.time)&&0<a.time&&(!core.isset(a.floorId)||a.floorId==core.status.floorId)?core.animateBlock(a.loc,"show",a.time,function(){a.loc.forEach(function(b){core.showBlock(b[0],b[1],a.floorId)});core.events.doAction()}):(a.loc.forEach(function(b){core.showBlock(b[0],b[1],a.floorId)}),this.doAction());break;case "hide":core.isset(a.loc)||
(a.loc=[b,c]);"number"==typeof a.loc[0]&&"number"==typeof a.loc[1]&&(a.loc=[a.loc]);a.loc.forEach(function(b){core.removeBlock(b[0],b[1],a.floorId)});core.isset(a.time)&&0<a.time&&(!core.isset(a.floorId)||a.floorId==core.status.floorId)?core.animateBlock(a.loc,"hide",a.time,function(){core.events.doAction()}):this.doAction();break;case "setBlock":core.isset(a.loc)&&(b=a.loc[0],c=a.loc[1]);var d=a.floorId||core.status.floorId,f=core.getBlock(b,c,d,!1),e=core.maps.getBlock(b,c,a.number);core.maps.addInfo(e);
core.maps.addEvent(e,b,c,core.floors[d].events[b+","+c]);core.maps.addChangeFloor(e,b,c,core.floors[d].changeFloor[b+","+c]);core.isset(e.event)&&(null==f?core.status.maps[d].blocks.push(e):(f.block.id=a.number,f.block.event=e.event),d==core.status.floorId&&(core.drawMap(d),core.drawHero(core.getHeroLoc("direction"),core.getHeroLoc("x"),core.getHeroLoc("y"),"stop"),core.updateStatusBar()));this.doAction();break;case "animate":core.isset(a.loc)&&("hero"==a.loc?(b=core.getHeroLoc("x"),c=core.getHeroLoc("y")):
a.loc instanceof Array&&(b=a.loc[0],c=a.loc[1]));core.drawAnimate(a.name,b,c,function(){core.events.doAction()});break;case "move":core.isset(a.loc)&&(b=a.loc[0],c=a.loc[1]);core.moveBlock(b,c,a.steps,a.time,a.immediateHide,function(){core.events.doAction()});break;case "moveHero":core.eventMoveHero(a.steps,a.time,function(){core.events.doAction()});break;case "changeFloor":b={x:a.loc[0],y:a.loc[1]};core.isset(a.direction)&&(b.direction=a.direction);core.changeFloor(a.floorId||core.status.floorId,
null,b,a.time,function(){core.lockControl();core.events.doAction()});break;case "changePos":core.clearMap("hero",0,0,416,416);core.isset(a.loc)&&(core.setHeroLoc("x",a.loc[0]),core.setHeroLoc("y",a.loc[1]));core.isset(a.direction)&&core.setHeroLoc("direction",a.direction);core.drawHero(core.getHeroLoc("direction"),core.getHeroLoc("x"),core.getHeroLoc("y"),"stop");this.doAction();break;case "showImage":core.isset(a.loc)&&core.isset(core.material.images.pngs[a.name])?core.canvas.animate.drawImage(core.material.images.pngs[a.name],
a.loc[0],a.loc[1]):core.clearMap("animate",0,0,416,416);this.doAction();break;case "setFg":core.setFg(a.color,a.time,function(){core.events.doAction()});break;case "setWeather":core.setWeather(a.name,a.level);this.doAction();break;case "openDoor":d=a.floorId||core.status.floorId;e=core.getBlock(a.loc[0],a.loc[1],d);if(null!=e){d==core.status.floorId?core.openDoor(e.block.event.id,e.block.x,e.block.y,!1,function(){core.events.doAction()}):(core.removeBlock(e.block.x,e.block.y,d),this.doAction());break}this.doAction();
break;case "openShop":core.status.replay.replaying?(core.status.shops[a.id].visited=!0,core.status.event.data.list=[],this.doAction()):core.events.openShop(a.id);break;case "disableShop":core.events.disableQuickShop(a.id);this.doAction();break;case "battle":core.battle(a.id,null,null,!0,function(){core.events.doAction()});break;case "trigger":e=core.getBlock(a.loc[0],a.loc[1]);null!=e&&(e=e.block,core.isset(e.event)&&"action"==e.event.trigger&&(core.status.event.data.list=core.clone(e.event.data),
core.status.event.data.x=e.x,core.status.event.data.y=e.y));this.doAction();break;case "playSound":core.playSound(a.name);this.doAction();break;case "playBgm":core.playBgm(a.name);this.doAction();break;case "pauseBgm":core.pauseBgm();this.doAction();break;case "resumeBgm":core.resumeBgm();this.doAction();break;case "setValue":try{d=core.calValue(a.value),0==a.name.indexOf("status:")&&(d=parseInt(d),core.setStatus(a.name.substring(7),d)),0==a.name.indexOf("item:")&&(d=parseInt(d),f=a.name.substring(5),
d>core.itemCount(f)?core.getItem(f,d-core.itemCount(f)):core.setItem(f,d)),0==a.name.indexOf("flag:")&&core.setFlag(a.name.substring(5),d)}catch(h){}0>=core.status.hero.hp?(core.status.hero.hp=0,core.updateStatusBar(),core.events.lose("damage")):(core.updateStatusBar(),this.doAction());break;case "input":if(core.status.replay.replaying)if(b=core.status.replay.toReplay.shift(),0==b.indexOf("input:"))d=parseInt(b.substring(6));else{core.stopReplay();core.drawTip("\u5f55\u50cf\u6587\u4ef6\u51fa\u9519");
break}else d=prompt(core.replaceText(a.text));d=Math.abs(parseInt(d)||0);core.status.route.push("input:"+d);core.setFlag("input",d);this.doAction();break;case "if":core.calValue(a.condition)?core.events.insertAction(a["true"]):core.events.insertAction(a["false"]);this.doAction();break;case "choices":if(core.status.replay.replaying)if(0==core.status.replay.toReplay.length)core.status.replay.replaying=!1,core.drawTip("\u5f55\u50cf\u56de\u653e\u5b8c\u6bd5");else{b=core.status.replay.toReplay.shift();
var g;0==b.indexOf("choices:")&&0<=(g=parseInt(b.substring(8)))&&g<a.choices.length?(core.status.event.selection=g,setTimeout(function(){core.status.route.push("choices:"+g);core.events.insertAction(a.choices[g].action);core.events.doAction()},750)):(core.stopReplay(),core.drawTip("\u5f55\u50cf\u6587\u4ef6\u51fa\u9519"))}core.ui.drawChoices(a.text,a.choices);break;case "win":core.events.win(a.reason,function(){core.events.doAction()});break;case "lose":core.events.lose(a.reason,function(){core.events.doAction()});
break;case "function":b=a["function"];core.isset(b)&&("string"==typeof b&&0==b.indexOf("function")?eval("("+b+")()"):b instanceof Function&&b());this.doAction();break;case "update":core.updateStatusBar();this.doAction();break;case "sleep":setTimeout(function(){core.events.doAction()},a.time);break;case "revisit":e=core.getBlock(b,c);null!=e&&(e=e.block,core.isset(e.event)&&"action"==e.event.trigger&&(core.status.event.data.list=core.clone(e.event.data)));this.doAction();break;case "exit":core.status.event.data.list=
[];core.events.doAction();break;default:core.status.event.data.type="text",core.ui.drawTextBox("\t[\u8b66\u544a]\u51fa\u9519\u5566\uff01\n"+a.type+" \u4e8b\u4ef6\u4e0d\u88ab\u652f\u6301...")}}};events.prototype.insertAction=function(a,b,c,d){null==core.status.event.id?this.doEvents(a,b,c,d):(core.unshift(core.status.event.data.list,a),core.isset(b)&&(core.status.event.data.x=b),core.isset(c)&&(core.status.event.data.y=c),core.isset(d)&&(core.status.event.data.callback=d))};
events.prototype.openShop=function(a,b){var c=core.status.shops[a];c.times=c.times||0;c.visited=c.visited||!1;if(b&&!c.visited)0==c.times?core.drawTip("\u8be5\u5546\u5e97\u5c1a\u672a\u5f00\u542f"):core.drawTip("\u8be5\u5546\u5e97\u5df2\u5931\u6548");else{c.visited=!0;b=core.status.event.selection;var d=[];core.isset(core.status.event.data)&&core.isset(core.status.event.data.actions)&&(d=core.status.event.data.actions);if(core.isset(core.status.event.data)&&core.isset(core.status.event.data.fromList))var f=
core.status.event.data.fromList;core.ui.closePanel();core.lockControl();core.status.event.id="shop";core.status.event.data={id:a,shop:c,actions:d,fromList:f};core.status.event.selection=b;a="\t["+c.name+","+c.icon+"]";eval(c.need);a+=c.text.replace(/\${([^}]+)}/g,function(a,b){return eval(b)});f="experience"==c.use?"\u7ecf\u9a8c":"\u91d1\u5e01";b=[];for(d=0;d<c.choices.length;d++){var e=c.choices[d],g=e.text;core.isset(e.need)&&(g+="\uff08"+eval(e.need)+f+"\uff09");b.push(g)}b.push("\u79bb\u5f00");
core.ui.drawChoices(a,b)}};events.prototype.disableQuickShop=function(a){core.status.shops[a].visited=!1};events.prototype.canUseQuickShop=function(a){return core.isset(core.floors[core.status.floorId].canUseQuickShop)&&!core.floors[core.status.floorId].canUseQuickShop?"\u5f53\u524d\u4e0d\u80fd\u4f7f\u7528\u5feb\u6377\u5546\u5e97\u3002":null};
events.prototype.checkLvUp=function(){if(core.flags.enableLevelUp&&!(core.status.hero.lv>=core.firstData.levelUp.length)){var a=core.firstData.levelUp[core.status.hero.lv].need;core.isset(a)&&core.status.hero.experience>=a&&(core.status.hero.lv++,a=core.firstData.levelUp[core.status.hero.lv-1].effect,"string"==typeof a?0==a.indexOf("function")?eval("("+a+")()"):a.split(";").forEach(function(a){core.doEffect(a)}):a instanceof Function&&a(),this.checkLvUp())}};
events.prototype.useItem=function(a){core.ui.closePanel();"book"==a?core.openBook(!1):"fly"==a?core.useFly(!1):"centerFly"==a?(core.status.usingCenterFly=!0,a="rgba(255,0,0,0.5)",core.canUseItem("centerFly")&&(a="rgba(0,255,0,0.5)"),core.fillRect("ui",32*(12-core.getHeroLoc("x")),32*(12-core.getHeroLoc("y")),32,32,a),core.drawTip("\u8bf7\u786e\u8ba4\u5f53\u524d\u4e2d\u5fc3\u5bf9\u79f0\u98de\u884c\u5668\u7684\u4f4d\u7f6e")):core.canUseItem(a)?core.useItem(a):core.drawTip("\u5f53\u524d\u65e0\u6cd5\u4f7f\u7528"+
core.material.items[a].name)};events.prototype.addPoint=function(a){a=a.point;return!core.isset(a)||0>=a?[]:[{type:"choices",choices:[{text:"\u653b\u51fb+"+1*a,action:[{type:"setValue",name:"status:atk",value:"status:atk+"+1*a}]},{text:"\u9632\u5fa1+"+2*a,action:[{type:"setValue",name:"status:def",value:"status:def+"+2*a}]},{text:"\u751f\u547d+"+200*a,action:[{type:"setValue",name:"status:hp",value:"status:hp+"+200*a}]}]}]};
events.prototype.afterBattle=function(a,b,c,d){var f=core.material.enemys[a],e=f.special;core.enemys.hasSpecial(e,12)&&!core.hasFlag("poison")&&core.setFlag("poison",!0);core.enemys.hasSpecial(e,13)&&!core.hasFlag("weak")&&(core.setFlag("weak",!0),core.status.hero.atk-=core.values.weakValue,core.status.hero.def-=core.values.weakValue);core.enemys.hasSpecial(e,14)&&!core.hasFlag("curse")&&core.setFlag("curse",!0);core.flags.hatredDecrease&&core.enemys.hasSpecial(e,17)&&core.setFlag("hatred",parseInt(core.getFlag("hatred",
0)/2));core.enemys.hasSpecial(e,19)&&(core.status.hero.hp=1);core.enemys.hasSpecial(e,21)&&(core.status.hero.atk-=f.atkValue||0,core.status.hero.def-=f.defValue||0,0>core.status.hero.atk&&(core.status.hero.atk=0),0>core.status.hero.def&&(core.status.hero.def=0));core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);core.updateStatusBar();f=[];!core.enemys.hasSpecial(e,18)&&core.isset(b)&&core.isset(c)&&(e=core.floors[core.status.floorId].afterBattle[b+","+c],core.isset(e)&&core.unshift(f,
e));e=core.material.enemys[a].point;core.isset(e)&&0<e&&core.unshift(f,core.events.addPoint(core.material.enemys[a]));0<f.length&&this.insertAction(f,b,c);null==core.status.event.id?core.continueAutomaticRoute():core.clearContinueAutomaticRoute();core.isset(d)&&d()};
events.prototype.afterOpenDoor=function(a,b,c,d){a=[];if(core.isset(b)&&core.isset(c)){var f=core.floors[core.status.floorId].afterOpenDoor[b+","+c];core.isset(f)&&core.unshift(a,f)}0<a.length&&this.insertAction(a,b,c);null==core.status.event.id?core.continueAutomaticRoute():core.clearContinueAutomaticRoute();core.isset(d)&&d()};
events.prototype.passNet=function(a){if(!core.hasItem("shoes")){if("lavaNet"==a.event.id){core.status.hero.hp-=core.values.lavaDamage;if(0>=core.status.hero.hp){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("lava");return}core.drawTip("\u7ecf\u8fc7\u8840\u7f51\uff0c\u751f\u547d-"+core.values.lavaDamage)}if("poisonNet"==a.event.id){if(core.hasFlag("poison"))return;core.setFlag("poison",!0)}if("weakNet"==a.event.id){if(core.hasFlag("weak"))return;core.setFlag("weak",!0);core.status.hero.atk-=
core.values.weakValue;core.status.hero.def-=core.values.weakValue}if("curseNet"==a.event.id){if(core.hasFlag("curse"))return;core.setFlag("curse",!0)}core.updateStatusBar()}};
events.prototype.changeLight=function(a,b){var c=core.getBlock(a,b);null!=c&&(c=c.block,"light"==c.event.id&&(c.id=166,c.event={cls:"terrains",id:"darkLight",noPass:!0},core.canvas.event.clearRect(32*a,32*b,32,32),core.canvas.event.drawImage(core.material.images[c.event.cls],0,32*core.material.icons[c.event.cls][c.event.id],32,32,32*c.x,32*c.y,32,32),this.afterChangeLight(a,b)))};events.prototype.afterChangeLight=function(a,b){};
events.prototype.ski=function(a){core.isset(a)||(a=core.status.automaticRoute.lastDirection||core.getHeroLoc("direction"));"ski"!=core.status.event.id?core.waitHeroToStop(function(){core.status.event.id="ski";core.events.ski(a)}):core.moveHero(a,function(){"ski"==core.status.event.id&&(core.status.event.id=null,core.unLockControl(),core.replay())})};
events.prototype.pushBox=function(a){if("box"==a.event.id||"boxed"==a.event.id){var b={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}},c=core.getHeroLoc("direction"),d=a.x+b[c].x;b=a.y+b[c].y;if(!(0>d||12<d||0>b||12<b)){var f=core.getBlock(d,b,null,!1);if(null==f||core.isset(f.block.event)&&"flower"==f.block.event.id)null==f?(core.status.thisMap.blocks.push(core.maps.getBlock(d,b,169)),f=core.material.icons.terrains.box):(f.block.id=170,f.block.event=core.maps.getBlock(null,null,170).event,
f=core.material.icons.terrains.boxed),core.canvas.event.clearRect(32*d,32*b,32,32),core.canvas.event.drawImage(core.material.images.terrains,0,32*f,32,32,32*d,32*b,32,32),"box"==a.event.id?core.removeBlock(a.x,a.y):(a.id=168,a.event=core.maps.getBlock(null,null,168).event,core.canvas.event.clearRect(32*a.x,32*a.y,32,32),core.canvas.event.drawImage(core.material.images.terrains,0,32*core.material.icons.terrains.flower,32,32,32*a.x,32*a.y,32,32)),core.updateStatusBar(),core.lockControl(),core.eventMoveHero([c],
null,function(){core.unLockControl();core.events.afterPushBox();core.replay()})}}};events.prototype.afterPushBox=function(){a:for(var a=0;a<core.status.thisMap.blocks.length;a++){var b=core.status.thisMap.blocks[a];if(core.isset(b.event)&&"box"==b.event.id)break a}};events.prototype.afterUseBomb=function(){};events.prototype.beforeSaveData=function(a){};events.prototype.afterLoadData=function(a){core.enemys.update()};events.prototype.longClick=function(){core.waitHeroToStop(function(){core.ui.drawKeyBoard()})};
events.prototype.keyDownCtrl=function(){"text"==core.status.event.id?core.drawText():"action"==core.status.event.id&&"text"==core.status.event.data.type&&this.doAction()};events.prototype.clickConfirmBox=function(a,b){4!=a&&5!=a||7!=b||!core.isset(core.status.event.data.yes)||core.status.event.data.yes();7!=a&&8!=a||7!=b||!core.isset(core.status.event.data.no)||core.status.event.data.no()};
events.prototype.keyUpConfirmBox=function(a){37==a&&(core.status.event.selection=0,core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no));39==a&&(core.status.event.selection=1,core.ui.drawConfirmBox(core.status.event.ui,core.status.event.data.yes,core.status.event.data.no));if(13==a||32==a||67==a)0==core.status.event.selection&&core.isset(core.status.event.data.yes)&&(core.status.event.selection=null,core.status.event.data.yes()),1==core.status.event.selection&&
core.isset(core.status.event.data.no)&&(core.status.event.selection=null,core.status.event.data.no())};events.prototype.clickAction=function(a,b){if("text"==core.status.event.data.type)this.doAction();else if("choices"==core.status.event.data.type){var c=core.status.event.data.current.choices;0!=c.length&&5<=a&&7>=a&&(a=6-parseInt((c.length-1)/2),b>=a&&b<a+c.length&&(core.status.route.push("choices:"+(b-a)),this.insertAction(c[b-a].action),this.doAction()))}};
events.prototype.keyDownAction=function(a){"choices"==core.status.event.data.type&&0<core.status.event.data.current.choices.length&&(38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)),40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices)))};
events.prototype.keyUpAction=function(a){if("text"==core.status.event.data.type&&(13==a||32==a||67==a))this.doAction();else if("choices"==core.status.event.data.type){var b=core.status.event.data.current.choices;0<b.length&&(13==a||32==a||67==a)&&(core.status.route.push("choices:"+core.status.event.selection),this.insertAction(b[core.status.event.selection].action),this.doAction())}};
events.prototype.clickBook=function(a,b){3!=a&&4!=a||12!=b?8!=a&&9!=a||12!=b?10<=a&&12>=a&&12==b?null==core.status.event.selection?core.ui.closePanel():(core.status.boxAnimateObjs=[],core.ui.drawMaps(core.status.event.selection)):(a=core.status.event.data,core.isset(a)&&12>b&&(b=6*parseInt(a/6)+parseInt(b/2),core.ui.drawBook(b),core.ui.drawBookDetail(b))):core.ui.drawBook(core.status.event.data+6):core.ui.drawBook(core.status.event.data-6)};
events.prototype.keyDownBook=function(a){37==a&&core.ui.drawBook(core.status.event.data-6);38==a&&core.ui.drawBook(core.status.event.data-1);39==a&&core.ui.drawBook(core.status.event.data+6);40==a&&core.ui.drawBook(core.status.event.data+1);33==a&&core.ui.drawBook(core.status.event.data-6);34==a&&core.ui.drawBook(core.status.event.data+6)};
events.prototype.keyUpBook=function(a){if(27==a||88==a)null==core.status.event.selection?core.ui.closePanel():(core.status.boxAnimateObjs=[],core.ui.drawMaps(core.status.event.selection));else if(13==a||32==a||67==a)a=core.status.event.data,core.isset(a)&&this.clickBook(6,a%6*2)};events.prototype.clickBookDetail=function(){core.clearMap("data",0,0,416,416);core.status.event.id="book"};
events.prototype.clickFly=function(a,b){10!=a&&11!=a||9!=b||core.ui.drawFly(core.status.event.data-1);10!=a&&11!=a||5!=b||core.ui.drawFly(core.status.event.data+1);5<=a&&7>=a&&12==b&&core.ui.closePanel();0<=a&&9>=a&&3<=b&&11>=b&&(a=core.status.hero.flyRange.indexOf(core.status.floorId),a=core.status.event.data<a?"upFloor":"downFloor",b=core.status.hero.flyRange[core.status.event.data],core.status.route.push("fly:"+b),core.ui.closePanel(),core.changeFloor(b,a))};
events.prototype.keyDownFly=function(a){37==a||38==a?core.ui.drawFly(core.status.event.data+1):(39==a||40==a)&&core.ui.drawFly(core.status.event.data-1)};events.prototype.keyUpFly=function(a){71!=a&&27!=a&&88!=a||core.ui.closePanel();13!=a&&32!=a&&67!=a||this.clickFly(5,5)};events.prototype.clickViewMaps=function(a,b){4>=b?core.ui.drawMaps(core.status.event.data+1):8<=b?core.ui.drawMaps(core.status.event.data-1):(core.clearMap("data",0,0,416,416),core.setOpacity("data",1),core.ui.closePanel())};
events.prototype.keyDownViewMaps=function(a){37==a||38==a||33==a?core.ui.drawMaps(core.status.event.data+1):(39==a||40==a||34==a)&&core.ui.drawMaps(core.status.event.data-1)};events.prototype.keyUpViewMaps=function(a){if(27==a||13==a||32==a||67==a)core.clearMap("data",0,0,416,416),core.setOpacity("data",1),core.ui.closePanel();88==a&&core.openBook(!1)};
events.prototype.clickShop=function(a,b){var c=core.status.event.data.shop,d=c.choices;if(5<=a&&7>=a)if(a=6-parseInt(d.length/2),b>=a&&b<a+d.length){core.status.event.selection=b-a;var f=core.getStatus("money"),e=core.getStatus("experience"),g=eval(c.need),h=c.use,k="money"==h?"\u91d1\u5e01":"\u7ecf\u9a8c";d=d[b-a];core.isset(d.need)&&(g=eval(d.need));if(g>eval(h))return core.drawTip("\u4f60\u7684"+k+"\u4e0d\u8db3"),!1;core.status.event.data.actions.push(b-a);eval(h+"-="+g);core.setStatus("money",
f);core.setStatus("experience",e);d.effect.split(";").forEach(function(a){core.doEffect(a)});core.updateStatusBar();c.times++;this.openShop(core.status.event.data.id)}else if(b==a+d.length)0<core.status.event.data.actions.length&&core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join("")),core.status.event.data.actions=[],core.status.boxAnimateObjs=[],core.status.event.data.fromList?core.ui.drawQuickShop():core.ui.closePanel();else return!1;return!0};
events.prototype.keyDownShop=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};
events.prototype.keyUpShop=function(a){if(27==a||88==a)0<core.status.event.data.actions.length&&core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join("")),core.status.event.data.actions=[],core.status.boxAnimateObjs=[],core.status.event.data.fromList?core.ui.drawQuickShop():core.ui.closePanel();else{var b=core.status.event.data.shop.choices;if(13==a||32==a||67==a)a=6-parseInt(b.length/2),this.clickShop(6,a+core.status.event.selection)}};
events.prototype.clickQuickShop=function(a,b){var c=Object.keys(core.status.shops);if(5<=a&&7>=a)if(a=6-parseInt(c.length/2),b>=a&&b<a+c.length){var d=core.events.canUseQuickShop(c[b-a]);core.isset(d)?core.drawText(d):(this.openShop(c[b-a],!0),"shop"==core.status.event.id&&(core.status.event.data.fromList=!0))}else b==a+c.length&&core.ui.closePanel()};
events.prototype.keyDownQuickShop=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};events.prototype.keyUpQuickShop=function(a){if(27==a||75==a||88==a)core.ui.closePanel();else{var b=Object.keys(core.status.shops);if(13==a||32==a||67==a)a=6-parseInt(b.length/2),this.clickQuickShop(6,a+core.status.event.selection)}};
events.prototype.clickToolbox=function(a,b){10<=a&&12>=a&&12==b?core.ui.closePanel():10<=a&&12>=a&&1>=b?core.isset(core.status.event.data)&&(core.flags.enableDeleteItem?(core.removeItem(core.status.event.data),core.status.event.data=null,core.ui.drawToolbox()):core.drawTip("\u4e0d\u652f\u6301\u5220\u9664\u9053\u5177\uff01")):(a=4==b||5==b||9==b||10==b?parseInt(a/2):6+parseInt(a/2),9<=b&&(a+=100),this.clickToolboxIndex(a))};
events.prototype.clickToolboxIndex=function(a){var b=a;if(100>b)var c=Object.keys(core.status.hero.items.tools).sort();else b-=100,c=Object.keys(core.status.hero.items.constants).sort();null==c||b>=c.length||(c=c[b],c==core.status.event.data?core.events.useItem(c):core.ui.drawToolbox(a))};
events.prototype.keyDownToolbox=function(a){if(core.isset(core.status.event.data)){var b=Object.keys(core.status.hero.items.tools).sort(),c=Object.keys(core.status.hero.items.constants).sort(),d=core.status.event.selection;if(37==a){if(0<d&&100>d||100<d){this.clickToolboxIndex(d-1);return}if(100==d&&0<b.length){this.clickToolboxIndex(b.length-1);return}}if(38==a){if(5<d&&100>d||105<d){this.clickToolboxIndex(d-6);return}if(100<=d&&105>=d){6<b.length?this.clickToolboxIndex(Math.min(b.length-1,d-100+
6)):0<b.length&&this.clickToolboxIndex(Math.min(b.length-1,d-100));return}}if(39==a){if(d<b.length-1||100<=d&&d<c.length+100){this.clickToolboxIndex(d+1);return}if(d==b.length-1&&0<c.length){this.clickToolboxIndex(100);return}}40==a&&(5>=d?6<b.length?this.clickToolboxIndex(Math.min(b.length-1,d+6)):0<c.length&&this.clickToolboxIndex(100+Math.min(c.length-1,d)):5<d&&100>d&&0<c.length?this.clickToolboxIndex(100+Math.min(c.length-1,d-6)):100<=d&&105>=d&&6<c.length&&this.clickToolboxIndex(Math.min(100+
c.length-1,d+6)))}};events.prototype.keyUpToolbox=function(a){84==a||27==a||88==a?core.ui.closePanel():core.isset(core.status.event.data)&&(13==a||32==a||67==a?this.clickToolboxIndex(core.status.event.selection):46==a&&core.isset(core.status.event.data)&&(core.flags.enableDeleteItem?(core.removeItem(core.status.event.data),core.status.event.data=null,core.ui.drawToolbox()):core.drawTip("\u4e0d\u652f\u6301\u5220\u9664\u9053\u5177\uff01")))};
events.prototype.clickSL=function(a,b){var c=core.status.event.data,d=parseInt(c/10);c%=10;3!=a&&4!=a||12!=b||core.ui.drawSLPanel(10*(d-1)+c);8!=a&&9!=a||12!=b||core.ui.drawSLPanel(10*(d+1)+c);10<=a&&12>=a&&12==b?(core.ui.closePanel(),core.isPlaying()||core.showStartAnimate()):(1<=b&&4>=b&&(1<=a&&3>=a&&core.doSL("autoSave",core.status.event.id),5<=a&&7>=a&&core.doSL(5*d+1,core.status.event.id),9<=a&&11>=a&&core.doSL(5*d+2,core.status.event.id)),7<=b&&10>=b&&(1<=a&&3>=a&&core.doSL(5*d+3,core.status.event.id),
5<=a&&7>=a&&core.doSL(5*d+4,core.status.event.id),9<=a&&11>=a&&core.doSL(5*d+5,core.status.event.id)))};
events.prototype.keyDownSL=function(a){var b=core.status.event.data,c=parseInt(b/10),d=b%10;37==a?0==d?core.ui.drawSLPanel(10*(c-1)+5):core.ui.drawSLPanel(b-1):38==a?3>d?core.ui.drawSLPanel(10*(c-1)+d+3):core.ui.drawSLPanel(b-3):39==a?5==d?core.ui.drawSLPanel(10*(c+1)+1):core.ui.drawSLPanel(b+1):40==a?3<=d?core.ui.drawSLPanel(10*(c+1)+d-3):core.ui.drawSLPanel(b+3):33==a?core.ui.drawSLPanel(10*(c-1)+d):34==a&&core.ui.drawSLPanel(10*(c+1)+d)};
events.prototype.keyUpSL=function(a){var b=core.status.event.data,c=parseInt(b/10);b%=10;if(27==a||88==a||"save"==core.status.event.id&&83==a||"load"==core.status.event.id&&68==a)core.ui.closePanel(),core.isPlaying()||core.showStartAnimate();else if(13==a||32==a||67==a)0==b?core.doSL("autoSave",core.status.event.id):core.doSL(5*c+b,core.status.event.id)};
events.prototype.clickSwitchs=function(a,b){if(!(5>a||7<a)){a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(b>=c&&b<c+a.length)switch(b-c){case 0:core.musicStatus.bgmStatus=!core.musicStatus.bgmStatus;core.musicStatus.bgmStatus?core.resumeBgm():core.pauseBgm();core.setLocalStorage("bgmStatus",core.musicStatus.bgmStatus);core.ui.drawSwitchs();break;case 1:core.musicStatus.soundStatus=!core.musicStatus.soundStatus;core.setLocalStorage("soundStatus",core.musicStatus.soundStatus);core.ui.drawSwitchs();
break;case 2:core.flags.canOpenBattleAnimate?(core.flags.battleAnimate=!core.flags.battleAnimate,core.setLocalStorage("battleAnimate",core.flags.battleAnimate),core.ui.drawSwitchs()):core.drawTip("\u672c\u5854\u4e0d\u80fd\u5f00\u542f\u6218\u6597\u52a8\u753b\uff01");break;case 3:core.flags.displayEnemyDamage=!core.flags.displayEnemyDamage;core.updateFg();core.setLocalStorage("enemyDamage",core.flags.displayEnemyDamage);core.ui.drawSwitchs();break;case 4:core.flags.displayExtraDamage=!core.flags.displayExtraDamage;
core.updateFg();core.setLocalStorage("extraDamage",core.flags.displayExtraDamage);core.ui.drawSwitchs();break;case 5:alert("Hello Biugle!");break;case 6:core.status.event.selection=0,core.ui.drawSettings()}}};events.prototype.keyDownSwitchs=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};
events.prototype.keyUpSwitchs=function(a){if(27==a||88==a)core.status.event.selection=0,core.ui.drawSettings();else{var b=core.status.event.ui.choices;if(13==a||32==a||67==a)a=6-parseInt((b.length-1)/2),this.clickSwitchs(6,a+core.status.event.selection)}};
events.prototype.clickSettings=function(a,b){if(!(5>a||7<a)){a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(b>=c&&b<c+a.length)switch(b-c){case 0:core.status.event.selection=0;core.ui.drawSwitchs();break;case 1:core.status.event.selection=0;core.ui.drawQuickShop();break;case 2:core.flags.enableViewMaps?core.drawText("\t[\u7cfb\u7edf\u63d0\u793a]\u5373\u5c06\u8fdb\u5165\u6d4f\u89c8\u5730\u56fe\u6a21\u5f0f\u3002\n\n\u70b9\u51fb\u5730\u56fe\u4e0a\u534a\u90e8\u5206\uff0c\u6216\u6309[\u2191]\u952e\u53ef\u67e5\u770b\u524d\u4e00\u5f20\u5730\u56fe\n\u70b9\u51fb\u5730\u56fe\u4e0b\u534a\u90e8\u5206\uff0c\u6216\u6309[\u2193]\u952e\u53ef\u67e5\u770b\u540e\u4e00\u5f20\u5730\u56fe\n\u70b9\u51fb\u5730\u56fe\u4e2d\u95f4\uff0c\u6216\u6309[ESC]\u952e\u53ef\u79bb\u5f00\u6d4f\u89c8\u5730\u56fe\u6a21\u5f0f\n\u6b64\u6a21\u5f0f\u4e0b\u53ef\u4ee5\u6253\u5f00\u602a\u7269\u624b\u518c\u4ee5\u67e5\u770b\u67d0\u5c42\u697c\u7684\u602a\u7269\u5c5e\u6027",
function(){core.ui.drawMaps(core.floorIds.indexOf(core.status.floorId))}):core.drawTip("\u672c\u5854\u4e0d\u5141\u8bb8\u6d4f\u89c8\u5730\u56fe\uff01");break;case 3:core.status.event.selection=0;core.ui.drawSyncSave();break;case 4:core.status.event.selection=1;core.ui.drawConfirmBox("\u4f60\u786e\u5b9a\u8981\u91cd\u65b0\u5f00\u59cb\u5417\uff1f",function(){core.ui.closePanel();core.restart()},function(){core.status.event.selection=3;core.ui.drawSettings()});break;case 5:core.ui.drawWaiting("\u6b63\u5728\u62c9\u53d6\u7edf\u8ba1\u4fe1\u606f\uff0c\u8bf7\u7a0d\u540e...");
b=new FormData;b.append("type","statistics");b.append("name",core.firstData.name);b.append("version",core.firstData.version);var d=new XMLHttpRequest;d.open("POST","/games/upload.php");d.onload=function(a){if(200==d.status)if(a=JSON.parse(d.response),0>a.code)core.drawText("\u51fa\u9519\u5566\uff01\n\u65e0\u6cd5\u62c9\u53d6\u7edf\u8ba1\u4fe1\u606f\u3002\n\u9519\u8bef\u539f\u56e0\uff1a"+a.msg);else{var b="\t[\u672c\u5854\u7edf\u8ba1\u4fe1\u606f]",c=!1;a.data.forEach(function(a){c&&(b+="\n\n");c=!0;
""!=a.hard&&(b+=a.hard+"\u96be\u5ea6\uff1a ");b+="\u5df2\u6709"+a.people+"\u4eba\u6b21\u6e38\u620f\uff0c"+a.score+"\u4eba\u6b21\u901a\u5173\u3002";a.info.forEach(function(a){""!=a.ending&&(b+="\n"+a.ending+"\uff1a \u5df2\u6709"+a.score+"\u4eba\u6b21\u901a\u5173\u3002");core.isset(a.max)&&0<a.max&&(b+="\n\u5f53\u524dMAX\u4e3a"+a.max+"\uff0c\u6700\u65e9\u7531 "+(a.username||"\u533f\u540d")+" \u4e8e"+core.formatDate(new Date(1E3*a.timestamp))+"\u6253\u51fa\u3002")})});core.drawText(b)}else core.drawText("\u51fa\u9519\u5566\uff01\n\u65e0\u6cd5\u62c9\u53d6\u7edf\u8ba1\u4fe1\u606f\u3002\n\u9519\u8bef\u539f\u56e0\uff1aHTTP "+
d.status)};d.ontimeout=function(){core.drawText("\u51fa\u9519\u5566\uff01\n\u65e0\u6cd5\u62c9\u53d6\u7edf\u8ba1\u4fe1\u606f\u3002\n\u9519\u8bef\u539f\u56e0\uff1aTimeout")};d.onerror=function(){core.drawText("\u51fa\u9519\u5566\uff01\n\u65e0\u6cd5\u62c9\u53d6\u7edf\u8ba1\u4fe1\u606f\u3002\n\u9519\u8bef\u539f\u56e0\uff1aXHR Error")};d.send(b);break;case 6:core.ui.drawHelp();break;case 7:core.ui.drawAbout();break;case 8:core.ui.closePanel()}}};
events.prototype.keyDownSettings=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};events.prototype.keyUpSettings=function(a){if(27==a||88==a)core.ui.closePanel();else{var b=core.status.event.ui.choices;if(13==a||32==a||67==a)a=6-parseInt((b.length-1)/2),this.clickSettings(6,a+core.status.event.selection)}};
events.prototype.clickSyncSave=function(a,b){if(!(5>a||7<a)){a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(b>=c&&b<c+a.length)switch(b-c){case 0:core.status.event.selection=0;core.ui.drawSyncSelect();break;case 1:core.syncLoad();break;case 2:core.status.event.selection=0;core.ui.drawLocalSaveSelect();break;case 3:core.readFile(function(a){if(a.name!=core.firstData.name)alert("\u5b58\u6863\u548c\u6e38\u620f\u4e0d\u4e00\u81f4\uff01");else if(a.version!=core.firstData.version)alert("\u6e38\u620f\u7248\u672c\u4e0d\u4e00\u81f4\uff01");
else if(core.isset(a.data)){var b=a.data;if(b instanceof Array)core.ui.drawConfirmBox("\u6240\u6709\u672c\u5730\u5b58\u6863\u90fd\u5c06\u88ab\u8986\u76d6\uff0c\u786e\u8ba4\uff1f",function(){for(var a=1;150>=a;a++)a<=b.length?core.setLocalStorage("save"+a,b[a-1]):core.removeLocalStorage("save"+a);core.drawText("\u8bfb\u53d6\u6210\u529f\uff01\n\u4f60\u7684\u672c\u5730\u6240\u6709\u5b58\u6863\u5747\u5df2\u88ab\u8986\u76d6\u3002")},function(){core.status.event.selection=0;core.ui.drawSyncSave()});else{for(var c=
a=150;1<=c;c--)if(null==core.getLocalStorage("save"+c,null))a=c;else break;core.setLocalStorage("save"+a,b);core.drawText("\u540c\u6b65\u6210\u529f\uff01\n\u5355\u5b58\u6863\u5df2\u8986\u76d6\u81f3\u5b58\u6863"+a)}}else alert("\u65e0\u6548\u7684\u5b58\u6863\uff01")},function(){});break;case 4:core.download(core.firstData.name+"_"+core.formatDate2(new Date)+".h5route",JSON.stringify({name:core.firstData.name,hard:core.status.hard,route:core.encodeRoute(core.status.route)}));break;case 5:core.status.event.selection=
1;core.ui.drawConfirmBox("\u4f60\u786e\u5b9a\u8981\u6e05\u7a7a\u6240\u6709\u5b58\u6863\u5417\uff1f",function(){localStorage.clear();core.drawText("\t[\u64cd\u4f5c\u6210\u529f]\u4f60\u7684\u6240\u6709\u5b58\u6863\u5df2\u88ab\u6e05\u7a7a\u3002")},function(){core.status.event.selection=5;core.ui.drawSyncSave()});break;case 6:core.status.event.selection=3,core.ui.drawSettings()}}};
events.prototype.keyDownSyncSave=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};
events.prototype.keyUpSyncSave=function(a){if(27==a||88==a)core.status.event.selection=2,core.ui.drawSettings();else{var b=core.status.event.ui.choices;if(13==a||32==a||67==a)a=6-parseInt((b.length-1)/2),this.clickSyncSave(6,a+core.status.event.selection)}};
events.prototype.clickSyncSelect=function(a,b){if(!(5>a||7<a)){a=core.status.event.ui.choices;var c=6-parseInt((a.length-1)/2);if(b>=c&&b<c+a.length)switch(b-c){case 0:core.syncSave("all");break;case 1:core.syncSave();break;case 2:core.status.event.selection=0,core.ui.drawSyncSave()}}};
events.prototype.keyDownSyncSelect=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};
events.prototype.keyUpSyncSelect=function(a){if(27==a||88==a)core.status.event.selection=0,core.ui.drawSettings();else{var b=core.status.event.ui.choices;if(13==a||32==a||67==a)a=6-parseInt((b.length-1)/2),this.clickSyncSelect(6,a+core.status.event.selection)}};
events.prototype.clickLocalSaveSelect=function(a,b){if(!(5>a||7<a)){var c=core.status.event.ui.choices,d=6-parseInt((c.length-1)/2);a=null;if(b>=d&&b<d+c.length)switch(b-d){case 0:a=[];for(b=1;150>=b;b++)c=core.getLocalStorage("save"+b,null),core.isset(c)&&a.push(c);break;case 1:for(b=150;1<=b&&(a=core.getLocalStorage("save"+b,null),!core.isset(a));b--);}core.isset(a)&&(a={name:core.firstData.name,version:core.firstData.version,data:a},core.download(core.firstData.name+"_"+core.formatDate2(new Date)+
".h5save",JSON.stringify(a)));core.status.event.selection=2;core.ui.drawSyncSave()}};events.prototype.keyDownLocalSaveSelect=function(a){38==a&&(core.status.event.selection--,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices));40==a&&(core.status.event.selection++,core.ui.drawChoices(core.status.event.ui.text,core.status.event.ui.choices))};
events.prototype.keyUpLocalSaveSelect=function(a){if(27==a||88==a)core.status.event.selection=0,core.ui.drawSettings();else{var b=core.status.event.ui.choices;if(13==a||32==a||67==a)a=6-parseInt((b.length-1)/2),this.clickLocalSaveSelect(6,a+core.status.event.selection)}};
events.prototype.clickKeyBoard=function(a,b){3==b&&1<=a&&11>=a&&(core.ui.closePanel(),core.keyUp(112+a-1));4==b&&1<=a&&10>=a&&(core.ui.closePanel(),core.keyUp(10==a?48:48+a));var c=["QWERTYUIOP".split(""),"ASDFGHJKL".split(""),"ZXCVBNM".split("")];5==b&&1<=a&&10>=a&&(core.ui.closePanel(),core.keyUp(c[0][a-1].charCodeAt(0)));6==b&&1<=a&&9>=a&&(core.ui.closePanel(),core.keyUp(c[1][a-1].charCodeAt(0)));7==b&&1<=a&&7>=a&&(core.ui.closePanel(),core.keyUp(c[2][a-1].charCodeAt(0)));8==b&&1<=a&&11>=a&&(core.ui.closePanel(),
1==a&&core.keyUp(189),2==a&&core.keyUp(187),3==a&&core.keyUp(219),4==a&&core.keyUp(221),5==a&&core.keyUp(220),6==a&&core.keyUp(186),7==a&&core.keyUp(222),8==a&&core.keyUp(188),9==a&&core.keyUp(190),10==a&&core.keyUp(191),11==a&&core.keyUp(192));9==b&&1<=a&&10>=a&&(core.ui.closePanel(),1==a&&core.keyUp(27),2==a&&core.keyUp(9),3==a&&core.keyUp(20),4==a&&core.keyUp(16),5==a&&core.keyUp(17),6==a&&core.keyUp(18),7==a&&core.keyUp(32),8==a&&core.keyUp(8),9==a&&core.keyUp(13),10==a&&core.keyUp(46));10==b&&
9<=a&&11>=a&&core.ui.closePanel()};events.prototype.clickCursor=function(a,b){a==core.status.automaticRoute.cursorX&&b==core.status.automaticRoute.cursorY?(core.ui.closePanel(),core.onclick(a,b,[])):(core.status.automaticRoute.cursorX=a,core.status.automaticRoute.cursorY=b,core.ui.drawCursor())};
events.prototype.keyDownCursor=function(a){37==a?(core.status.automaticRoute.cursorX--,core.ui.drawCursor()):38==a?(core.status.automaticRoute.cursorY--,core.ui.drawCursor()):39==a?(core.status.automaticRoute.cursorX++,core.ui.drawCursor()):40==a&&(core.status.automaticRoute.cursorY++,core.ui.drawCursor())};
events.prototype.keyUpCursor=function(a){if(27==a||88==a)core.ui.closePanel();else if(13==a||32==a||67==a||69==a)core.ui.closePanel(),core.onclick(core.status.automaticRoute.cursorX,core.status.automaticRoute.cursorY,[])};events.prototype.clickAbout=function(){core.isPlaying()?core.ui.closePanel():core.showStartAnimate()};