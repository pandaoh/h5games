function ui(){}ui.prototype.init=function(){};main.instance.ui=new ui;ui.prototype.closePanel=function(){core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.unLockControl();core.status.event.data=null;core.status.event.id=null;core.status.event.selection=null;core.status.event.ui=null};
ui.prototype.drawTextBox=function(a){var c=null,d=null,g=null,e=null;if(0==a.indexOf("\t[")||0==a.indexOf("\\t[")){var b=a.indexOf("]");if(0<=b){var f=a.substring(2,b);0==a.indexOf("\\t[")&&(f=a.substring(3,b));a=a.substring(b+1);b=f.split(",");1==b.length?(c=b[0],"hero"!=c&&(core.isset(core.material.enemys[c])?(d=core.material.enemys[c].name,g=core.material.images.enemys,e=core.material.icons.enemys[c]):(d=c,c="npc",e=g=null))):(c="npc",d=b[0],g=core.material.images.npcs,e=core.material.icons.npcs[b[1]])}}var h=
core.status.textAttribute||core.initStatus.textAttribute,q=h.position,k=null,m=null,t=0;if(0==a.indexOf("\b[")||0==a.indexOf("\\b["))if(b=a.indexOf("]"),0<=b&&(f=a.substring(2,b),0==a.indexOf("\\b[")&&(f=a.substring(3,b)),a=a.substring(b+1),b=f.split(","),"up"==b[0]||"center"==b[0]||"down"==b[0]))q=b[0],"action"==core.status.event.id&&(k=core.status.event.data.x,m=core.status.event.data.y),2<=b.length&&("hero"==b[1]?(k=core.getHeroLoc("x"),m=core.getHeroLoc("y"),t=core.material.icons.hero.height-
32):3<=b.length&&(k=parseInt(b[1]),m=parseInt(b[2])));a=core.replaceText(a);f=core.canvas.ui.createPattern(core.material.ground,"repeat");core.status.boxAnimateObjs=[];core.clearMap("ui",0,0,416,416);b=35;if("hero"==c||core.isset(e))b=73;a=core.splitLines("ui",a,396-(b-10)-13,"16px Verdana");var n=20+21*(a.length+1)+("hero"==c?core.material.icons.hero.height-10:core.isset(d)?22:0),l;"center"==q?l=(416-n)/2:"up"==q?l=null==k||null==m?5:32*m-n-t-22:"down"==q&&(l=null==k||null==m?416-n-5:32*m+54);core.setAlpha("ui",
h.background[3]);core.setFillStyle("ui",core.arrayToRGB(h.background));core.setStrokeStyle("ui","#FFFFFF");core.fillRect("ui",10,l,396,n);core.strokeRect("ui",9,l-1,397,n+1,"#FFFFFF",2);"up"==q&&core.isset(k)&&core.isset(m)&&(core.canvas.ui.clearRect(32*k+6,l+n-1,20,2),core.canvas.ui.beginPath(),core.canvas.ui.moveTo(32*k+6-1,l+n-1),core.canvas.ui.lineTo(32*k+16,l+n+22-2),core.canvas.ui.lineTo(32*k+32-6+1,l+n-1),core.canvas.ui.moveTo(32*k+6-1,l+n-1),core.canvas.ui.closePath(),core.canvas.ui.fill(),
core.drawLine("ui",32*k+6,l+n,32*k+16,l+n+22-2),core.drawLine("ui",32*k+32-6,l+n,32*k+16,l+n+22-2));"down"==q&&core.isset(k)&&core.isset(m)&&(core.canvas.ui.clearRect(32*k+6,l-2,20,3),core.canvas.ui.beginPath(),core.canvas.ui.moveTo(32*k+6-1,l+1),core.canvas.ui.lineTo(32*k+16-1,l-22+2),core.canvas.ui.lineTo(32*k+32-6-1,l+1),core.canvas.ui.moveTo(32*k+6-1,l+1),core.canvas.ui.closePath(),core.canvas.ui.fill(),core.drawLine("ui",32*k+6,l,32*k+16,l-22+2),core.drawLine("ui",32*k+32-6,l,32*k+16,l-22+2));
core.canvas.ui.textAlign="left";q=l+35;core.isset(c)&&(q=l+57,core.setAlpha("ui",h.title[3]),core.setFillStyle("ui",core.arrayToRGB(h.title)),core.setStrokeStyle("ui",core.arrayToRGB(h.title)),"hero"==c?(c=core.material.icons.hero.height,core.strokeRect("ui",24,l+40-1,34,c+2,null,2),core.fillText("ui",core.status.hero.name,b,l+30,null,"bold 22px Verdana"),core.clearMap("ui",25,l+40,32,c),core.fillRect("ui",25,l+40,32,c,f),d=core.material.icons.hero.down,core.canvas.ui.drawImage(core.material.images.hero,
32*d.stop,d.loc*c,32,c,25,l+40,32,c)):(core.fillText("ui",d,b,l+30,null,"bold 22px Verdana"),core.isset(e)&&(core.strokeRect("ui",24,l+40-1,34,34,null,2),core.status.boxAnimateObjs=[],core.status.boxAnimateObjs.push({bgx:25,bgy:l+40,bgsize:32,image:g,x:25,y:l+40,icon:e}),core.drawBoxAnimate())));core.setAlpha("ui",h.text[3]);core.setFillStyle("ui",core.arrayToRGB(h.text));for(h=0;h<a.length;h++)core.fillText("ui",a[h],b,q,null,"16px Verdana"),q+=21};
ui.prototype.drawChoices=function(a,c){var d=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",d);core.status.event.ui={text:a,choices:c};var g=c.length,e=32*(g+2),b=208+e/2;0==g%2&&(b+=16);g=b-e+56;var f=null,h=null,q=null,k=null,m=null,t=100;if(core.isset(a)){0==a.indexOf("\t[")&&(m=a.indexOf("]"),0<=m&&(f=a.substring(2,m),a=a.substring(m+1),m=f.split(","),1==m.length?(f=m[0],"hero"!=f&&(core.isset(core.material.enemys[f])?
(h=core.material.enemys[f].name,q=core.material.images.enemys,k=core.material.icons.enemys[f]):(h=f,f="npc",k=q=null))):(f="npc",h=m[0],q=core.material.images.npcs,k=core.material.icons.npcs[m[1]])));a=core.replaceText(a);if("hero"==f||core.isset(k))t=145;m=core.splitLines("ui",a,246-(t-85)-10,"bold 15px Verdana");a=0;null!=h&&(a+=25);a+=20*m.length;e+=a}b-=e;core.fillRect("ui",85,b,246,e,d);core.strokeRect("ui",84,b-1,247,e+1,"#FFFFFF",2);if(core.isset(m)){e=b+35;if(core.isset(f)){core.canvas.ui.textAlign=
"center";e=b+55;a=208;if("hero"==f||core.isset(k))a+=22;"hero"==f?(h=core.material.icons.hero.height,core.strokeRect("ui",99,b+30-1,34,h+2,"#DDDDDD",2),core.fillText("ui",core.status.hero.name,a,b+27,"#FFD700","bold 19px Verdana"),core.clearMap("ui",100,b+30,32,h),core.fillRect("ui",100,b+30,32,h,d),d=core.material.icons.hero.down,core.canvas.ui.drawImage(core.material.images.hero,32*d.stop,d.loc*h,32,h,100,b+30,32,h)):(core.fillText("ui",h,a,b+27,"#FFD700","bold 19px Verdana"),core.isset(k)&&(core.strokeRect("ui",
99,b+30-1,34,34,"#DDDDDD",2),core.status.boxAnimateObjs=[],core.status.boxAnimateObjs.push({bgx:100,bgy:b+30,bgsize:32,image:q,x:100,y:b+30,icon:k}),core.drawBoxAnimate()))}core.canvas.ui.textAlign="left";for(d=0;d<m.length;d++)core.fillText("ui",m[d],t,e,"#FFFFFF","bold 15px Verdana"),e+=20}core.canvas.ui.textAlign="center";for(d=0;d<c.length;d++)core.fillText("ui",core.replaceText(c[d].text||c[d]),208,g+32*d,"#FFFFFF","bold 17px Verdana");0<c.length&&(core.isset(core.status.event.selection)||(core.status.event.selection=
0),0>core.status.event.selection&&(core.status.event.selection=0),core.status.event.selection>=c.length&&(core.status.event.selection=c.length-1),c=core.canvas.ui.measureText(core.replaceText(c[core.status.event.selection].text||c[core.status.event.selection])).width,core.strokeRect("ui",208-c/2-5,g+32*core.status.event.selection-20,c+10,28,"#FFD700",2))};
ui.prototype.drawConfirmBox=function(a,c,d){core.lockControl();core.status.event.id="confirmBox";core.status.event.data={yes:c,no:d};core.status.event.ui=a;if(!core.isset(core.status.event.selection)||1<core.status.event.selection)core.status.event.selection=1;0>core.status.event.selection&&(core.status.event.selection=0);c=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",c);core.setFont("ui","bold 19px Verdana");
a=a.split("\n");var g=a.length;d=0;for(var e in a)d=Math.max(d,core.canvas.ui.measureText(a[e]).width);d=Math.min(168-d/2,100);g=140-30*(g-1);var b=416-2*d,f=276-g;core.isPlaying()&&core.fillRect("ui",d,g,b,f,c);core.isPlaying()&&core.strokeRect("ui",d-1,g-1,b+1,f+1,"#FFFFFF",2);core.canvas.ui.textAlign="center";for(e in a)core.fillText("ui",a[e],208,g+50+30*e,"#FFFFFF");core.fillText("ui","\u786e\u5b9a",170,g+f-35,"#FFFFFF","bold 17px Verdana");core.fillText("ui","\u53d6\u6d88",246,g+f-35);e=core.canvas.ui.measureText("\u786e\u5b9a").width;
0==core.status.event.selection&&core.strokeRect("ui",170-e/2-5,g+f-35-20,e+10,28,"#FFD700",2);1==core.status.event.selection&&core.strokeRect("ui",246-e/2-5,g+f-35-20,e+10,28,"#FFD700",2)};
ui.prototype.drawSwitchs=function(){core.status.event.id="switchs";this.drawChoices(null,["\u80cc\u666f\u97f3\u4e50\uff1a"+(core.musicStatus.bgmStatus?"[ON]":"[OFF]"),"\u80cc\u666f\u97f3\u6548\uff1a"+(core.musicStatus.soundStatus?"[ON]":"[OFF]"),"\u6218\u6597\u52a8\u753b\uff1a "+(core.flags.battleAnimate?"[ON]":"[OFF]"),"\u602a\u7269\u663e\u4f24\uff1a "+(core.flags.displayEnemyDamage?"[ON]":"[OFF]"),"\u9886\u57df\u663e\u4f24\uff1a "+(core.flags.displayExtraDamage?"[ON]":"[OFF]"),"\u4e0b\u8f7d\u79bb\u7ebf\u7248\u672c",
"\u8fd4\u56de\u4e3b\u83dc\u5355"])};ui.prototype.drawSettings=function(){core.status.event.id="settings";this.drawChoices(null,"\u7cfb\u7edf\u8bbe\u7f6e \u5feb\u6377\u5546\u5e97 \u6d4f\u89c8\u5730\u56fe \u540c\u6b65\u5b58\u6863 \u91cd\u65b0\u5f00\u59cb \u6570\u636e\u7edf\u8ba1 \u64cd\u4f5c\u5e2e\u52a9 \u5173\u4e8e\u672c\u5854 \u8fd4\u56de\u6e38\u620f".split(" "))};
ui.prototype.drawQuickShop=function(){core.status.event.id="selectShop";for(var a=core.status.shops,c=Object.keys(a),d=[],g=0;g<c.length;g++)d.push(a[c[g]].textInList);d.push("\u8fd4\u56de\u6e38\u620f");this.drawChoices(null,d)};
ui.prototype.drawBattleAnimate=function(a,c){core.lockControl();core.isset(core.status.event.id)||(core.status.event={id:"battle"});var d=core.getStatus("hp"),g=core.getStatus("atk"),e=core.getStatus("def"),b=core.getStatus("mdef"),f=core.material.enemys[a],h=f.hp,q=f.atk,k=f.def,m=f.money,t=f.experience,n=f.special,l=0;if(core.enemys.hasSpecial(n,11)){var r=d*f.value;r=parseInt(r);f.add&&(h+=r);l+=r}d-=core.enemys.getExtraDamage(f);core.enemys.hasSpecial(n,10)&&(q=g,k=e);core.enemys.hasSpecial(n,
2)&&(e=0);core.enemys.hasSpecial(n,3)&&k<g&&(k=g-1);var v=0;core.enemys.hasSpecial(n,1)&&(v=1);var w=2;core.enemys.hasSpecial(n,4)&&(w=3);core.enemys.hasSpecial(n,5)&&(w=4);core.enemys.hasSpecial(n,6)&&(w=1+(f.n||4));core.enemys.hasSpecial(n,7)&&(l+=parseInt(core.values.breakArmor*e));core.enemys.hasSpecial(n,9)&&(l+=parseInt(core.values.purify*b));b-=l;0>b&&(d+=b,b=0);f=core.enemys.getSpecialText(a);l=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);r=3;
if(core.flags.enableMDef||core.flags.enableMoney||core.flags.enableExperience)r=4;core.flags.enableMoney&&core.flags.enableExperience&&(r=5);r=60*r+50;var p=(416-r)/2;core.setAlpha("ui",.85);core.fillRect("ui",10,p,396,r,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",9,p-1,397,r+1,"#FFFFFF",2);core.clearMap("data",0,0,416,416);clearInterval(core.interval.tipAnimate);core.setAlpha("data",1);core.setOpacity("data",1);core.status.boxAnimateObjs=[];var u=core.material.icons.hero.height;core.strokeRect("ui",
44,p+35-1,42,u+40-32+2,"#FFD700",2);core.strokeRect("ui",330,p+35-1,42,42);core.canvas.ui.textAlign="center";core.fillText("ui",core.status.hero.name,65,p+35+u+40,"#FFD700","bold 22px Verdana");core.fillText("ui","\u602a\u7269",351,p+35+32+40);for(var x=r=0;r<f.length;r++)""!=f[r]&&core.fillText("ui",f[r],351,p+35+32+44+20*++x,"#FF6A6A","15px Verdana");core.clearMap("ui",45,p+35,40,u+40-32);core.fillRect("ui",45,p+35,40,u+40-32,l);f=core.material.icons.hero.down;core.canvas.ui.drawImage(core.material.images.hero,
32*f.stop,f.loc*u,32,u,49,p+35+4,32,u);core.status.boxAnimateObjs=[];core.status.boxAnimateObjs.push({bgx:331,bgy:p+35,bgsize:40,image:core.material.images.enemys,x:335,y:p+35+4,icon:core.material.icons.enemys[a]});core.drawBoxAnimate();core.canvas.ui.textAlign="left";a=p+35+10;core.fillText("ui","\u751f\u547d\u503c",95,a,"#DDDDDD","16px Verdana");core.drawLine("ui",95,a+8,175,a+8,"#FFFFFF",2);core.canvas.data.textAlign="right";core.fillText("data",d,175,a+26,"#DDDDDD","bold 16px Verdana");a+=60;
core.canvas.ui.textAlign="left";core.fillText("ui","\u653b\u51fb",95,a,"#DDDDDD","16px Verdana");core.drawLine("ui",95,a+8,175,a+8,"#FFFFFF",2);core.canvas.ui.textAlign="right";core.fillText("ui",g,175,a+26,"#DDDDDD","bold 16px Verdana");a+=60;core.canvas.ui.textAlign="left";core.fillText("ui","\u9632\u5fa1",95,a,"#DDDDDD","16px Verdana");core.drawLine("ui",95,a+8,175,a+8,"#FFFFFF",2);core.canvas.ui.textAlign="right";core.fillText("ui",e,175,a+26,"#DDDDDD","bold 16px Verdana");core.flags.enableMDef&&
(a+=60,core.canvas.ui.textAlign="left",core.fillText("ui","\u62a4\u76fe",95,a,"#DDDDDD","16px Verdana"),core.drawLine("ui",95,a+8,175,a+8,"#FFFFFF",2),core.canvas.data.textAlign="right",core.fillText("data",b,175,a+26,"#DDDDDD","bold 16px Verdana"));core.canvas.ui.textAlign="right";a=p+35+10;core.fillText("ui","\u751f\u547d\u503c",321,a,"#DDDDDD","16px Verdana");core.drawLine("ui",241,a+8,321,a+8,"#FFFFFF",2);core.canvas.data.textAlign="left";core.fillText("data",h,241,a+26,"#DDDDDD","bold 16px Verdana");
a+=60;core.canvas.ui.textAlign="right";core.fillText("ui","\u653b\u51fb",321,a,"#DDDDDD","16px Verdana");core.drawLine("ui",241,a+8,321,a+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",q,241,a+26,"#DDDDDD","bold 16px Verdana");a+=60;core.canvas.ui.textAlign="right";core.fillText("ui","\u9632\u5fa1",321,a,"#DDDDDD","16px Verdana");core.drawLine("ui",241,a+8,321,a+8,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui",k,241,a+26,"#DDDDDD","bold 16px Verdana");core.flags.enableMoney&&
(a+=60,core.canvas.ui.textAlign="right",core.fillText("ui","\u91d1\u5e01",321,a,"#DDDDDD","16px Verdana"),core.drawLine("ui",241,a+8,321,a+8,"#FFFFFF",2),core.canvas.ui.textAlign="left",core.fillText("ui",m,241,a+26,"#DDDDDD","bold 16px Verdana"));core.flags.enableExperience&&(a+=60,core.canvas.ui.textAlign="right",core.fillText("ui","\u7ecf\u9a8c",321,a,"#DDDDDD","16px Verdana"),core.drawLine("ui",241,a+8,321,a+8,"#FFFFFF",2),core.canvas.ui.textAlign="left",core.fillText("ui",t,241,a+26,"#DDDDDD",
"bold 16px Verdana"));core.canvas.ui.textAlign="left";core.fillText("ui","V",183,193,"#FFFFFF","italic bold 40px Verdana");core.canvas.ui.textAlign="right";core.fillText("ui","S",233,223,"#FFFFFF","italic bold 40px Verdana");var y=setInterval(function(){core.playSound("attack.ogg");if(0==v)core.drawLine("data",337,p+35+40-6,365,p+35+6,"#FF0000",4),setTimeout(function(){core.clearMap("data",331,p+35,40,40)},250),0<g-k&&(h-=g-k),0>h&&(h=0),core.clearMap("data",241,p+35+10,80,40),core.canvas.data.textAlign=
"left",core.fillText("data",h,241,p+35+10+26,"#DDDDDD","bold 16px Verdana"),core.enemys.hasSpecial(n,8)&&(b-=parseInt(core.values.counterAttack*g),0>b&&(d+=b,b=0),core.clearMap("data",95,p+35+10,80,40),core.canvas.data.textAlign="right",core.fillText("data",d,175,p+35+10+26,"#DDDDDD","bold 16px Verdana"),core.flags.enableMDef&&(core.clearMap("data",95,p+35+10+180,80,40),core.fillText("data",b,175,p+35+10+26+180)));else{core.drawLine("data",51,p+35+u+8-6,79,p+35+6,"#FF0000",4);setTimeout(function(){core.clearMap("data",
45,p+35,40,u+40-32)},250);var a=q-e;0>a&&(a=0);b-=a;0>b&&(d+=b,b=0);core.clearMap("data",95,p+35+10,80,40);core.canvas.data.textAlign="right";core.fillText("data",d,175,p+35+10+26,"#DDDDDD","bold 16px Verdana");core.flags.enableMDef&&(core.clearMap("data",95,p+35+10+180,80,40),core.fillText("data",b,175,p+35+10+26+180))}v++;v>=w&&(v=0);if(0>=d||0>=h)clearInterval(y),core.status.boxAnimateObjs=[],core.clearMap("ui",0,0,416,416),core.setAlpha("ui",1),core.clearMap("data",0,0,416,416),"battle"==core.status.event.id&&
(core.unLockControl(),core.status.event.id=null),core.isset(c)&&c()},500)};
ui.prototype.drawWaiting=function(a){core.lockControl();core.status.event.id="waiting";var c=core.canvas.ui.createPattern(core.material.ground,"repeat");core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",c);core.setFont("ui","bold 17px Verdana");var d=core.canvas.ui.measureText(a).width;d=Math.max(d+50,220);var g=208-d/2;core.fillRect("ui",g,160,d,96,c);core.strokeRect("ui",g-1,159,d+1,97,"#FFFFFF",2);core.canvas.ui.textAlign="center";core.fillText("ui",a,208,216,"#FFFFFF")};
ui.prototype.drawSyncSave=function(){core.status.event.id="syncSave";this.drawChoices(null,"\u540c\u6b65\u5b58\u6863\u5230\u670d\u52a1\u5668 \u4ece\u670d\u52a1\u5668\u52a0\u8f7d\u5b58\u6863 \u5b58\u6863\u81f3\u672c\u5730\u6587\u4ef6 \u4ece\u672c\u5730\u6587\u4ef6\u8bfb\u6863 \u4e0b\u8f7d\u5f53\u524d\u5f55\u50cf \u6e05\u7a7a\u672c\u5730\u5b58\u6863 \u8fd4\u56de\u4e3b\u83dc\u5355".split(" "))};
ui.prototype.drawSyncSelect=function(){core.status.event.id="syncSelect";this.drawChoices(null,["\u540c\u6b65\u672c\u5730\u6240\u6709\u5b58\u6863","\u53ea\u540c\u6b65\u6700\u65b0\u5355\u5b58\u6863","\u8fd4\u56de\u4e0a\u7ea7\u83dc\u5355"])};ui.prototype.drawLocalSaveSelect=function(){core.status.event.id="localSaveSelect";this.drawChoices(null,["\u4e0b\u8f7d\u6240\u6709\u5b58\u6863","\u53ea\u4e0b\u8f7d\u6700\u65b0\u5355\u5b58\u6863","\u8fd4\u56de\u4e0a\u7ea7\u83dc\u5355"])};
ui.prototype.drawPagination=function(a,c){core.setFont("ui","bold 15px Verdana");core.setFillStyle("ui","#DDDDDD");var d=core.canvas.ui.measureText(a+" / "+a).width;core.canvas.ui.textAlign="left";core.fillText("ui",a+" / "+c,(416-d)/2,403);core.canvas.ui.textAlign="center";1<a&&core.fillText("ui","\u4e0a\u4e00\u9875",128,403);a<c&&core.fillText("ui","\u4e0b\u4e00\u9875",288,403);core.fillText("ui","\u8fd4\u56de\u6e38\u620f",370,403)};
ui.prototype.drawCursor=function(){core.isset(core.status.automaticRoute.cursorX)||(core.status.automaticRoute.cursorX=core.getHeroLoc("x"));0>core.status.automaticRoute.cursorX&&(core.status.automaticRoute.cursorX=0);12<core.status.automaticRoute.cursorX&&(core.status.automaticRoute.cursorX=12);core.isset(core.status.automaticRoute.cursorY)||(core.status.automaticRoute.cursorY=core.getHeroLoc("y"));0>core.status.automaticRoute.cursorY&&(core.status.automaticRoute.cursorY=0);12<core.status.automaticRoute.cursorY&&
(core.status.automaticRoute.cursorY=12);core.status.event.id="cursor";core.lockControl();core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.strokeRect("ui",32*core.status.automaticRoute.cursorX+2,32*core.status.automaticRoute.cursorY+2,28,28,"#FFD700",4)};
ui.prototype.drawBook=function(a){var c=core.enemys.getCurrentEnemys(core.floorIds[core.status.event.selection]),d=core.canvas.ui.createPattern(core.material.ground,"repeat");clearInterval(core.interval.tipAnimate);core.clearMap("data",0,0,416,416);core.setOpacity("data",1);core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);core.setFillStyle("ui",d);core.fillRect("ui",0,0,416,416);core.setAlpha("ui",.6);core.setFillStyle("ui","#000000");core.fillRect("ui",0,0,416,416);core.setAlpha("ui",1);core.canvas.ui.textAlign=
"left";core.setFont("ui","bold 15px Verdana");if(0==c.length)core.fillText("ui","\u672c\u5c42\u65e0\u602a\u7269",83,222,"#999999","bold 50px Verdana"),core.canvas.ui.textAlign="center",core.fillText("ui","\u8fd4\u56de\u6e38\u620f",370,403,"#DDDDDD","bold 15px Verdana");else{0>a&&(a=0);a>=c.length&&(a=c.length-1);d=parseInt(a/6)+1;var g=parseInt((c.length-1)/6)+1;core.status.event.data=a;var e=6*(d-1);c=c.slice(e,Math.min(6*d,c.length));core.status.boxAnimateObjs=[];for(var b=0;b<c.length;b++){var f=
c[b];core.strokeRect("ui",22,62*b+22,42,42,"#DDDDDD",2);core.status.boxAnimateObjs.push({bgx:22,bgy:62*b+22,bgsize:42,image:core.material.images.enemys,x:27,y:62*b+27,icon:core.material.icons.enemys[f.id]});core.canvas.ui.textAlign="center";""==f.special?core.fillText("ui",f.name,115,62*b+47,"#DDDDDD","bold 17px Verdana"):(core.fillText("ui",f.name,115,62*b+40,"#DDDDDD","bold 17px Verdana"),core.fillText("ui",f.special,115,62*b+62,"#FF6A6A","bold 15px Verdana"));core.canvas.ui.textAlign="left";core.fillText("ui",
"\u751f\u547d",165,62*b+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.hp,195,62*b+32,"#DDDDDD","bold 13px Verdana");core.fillText("ui","\u653b\u51fb",255,62*b+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.atk,285,62*b+32,"#DDDDDD","bold 13px Verdana");core.fillText("ui","\u9632\u5fa1",335,62*b+32,"#DDDDDD","13px Verdana");core.fillText("ui",f.def,365,62*b+32,"#DDDDDD","bold 13px Verdana");var h=165;core.flags.enableMoney&&(core.fillText("ui","\u91d1\u5e01",165,62*b+50,"#DDDDDD","13px Verdana"),
core.fillText("ui",f.money,195,62*b+50,"#DDDDDD","bold 13px Verdana"),h=255);core.flags.enableExperience&&(core.canvas.ui.textAlign="left",core.fillText("ui","\u7ecf\u9a8c",h,62*b+50,"#DDDDDD","13px Verdana"),core.fillText("ui",f.experience,h+30,62*b+50,"#DDDDDD","bold 13px Verdana"));h=281;if(core.flags.enableMoney&&core.flags.enableExperience)h=361;else if(core.flags.enableMoney||core.flags.enableExperience)h=326;core.canvas.ui.textAlign="center";var q=f.damage,k="#FFFF00";q>=core.status.hero.hp&&
(k="#FF0000");0>=q&&(k="#00FF00");999999999<=q&&(q="\u65e0\u6cd5\u6218\u6597");core.fillText("ui",q,h,62*b+50,k,"bold 13px Verdana");core.canvas.ui.textAlign="left";core.fillText("ui","\u4e34\u754c",165,62*b+68,"#DDDDDD","13px Verdana");core.fillText("ui",f.critical,195,62*b+68,"#DDDDDD","bold 13px Verdana");core.fillText("ui","\u51cf\u4f24",255,62*b+68,"#DDDDDD","13px Verdana");core.fillText("ui",f.criticalDamage,285,62*b+68,"#DDDDDD","bold 13px Verdana");core.fillText("ui","1\u9632",335,62*b+68,
"#DDDDDD","13px Verdana");core.fillText("ui",f.defDamage,365,62*b+68,"#DDDDDD","bold 13px Verdana");a==e+b&&core.strokeRect("ui",10,62*b+13,396,62,"#FFD700")}core.drawBoxAnimate();this.drawPagination(d,g)}};
ui.prototype.drawBookDetail=function(a){var c=core.enemys.getCurrentEnemys(core.floorIds[core.status.event.selection]);if(0!=c.length)if(0>a&&(a=0),a>=c.length&&(a=c.length-1),a=c[a],c=core.enemys.getSpecialHint(core.enemys.getEnemys(a.id)),0==c.length)core.drawTip("\u8be5\u602a\u7269\u65e0\u7279\u6b8a\u5c5e\u6027\uff01");else{c=c.join("\n");core.status.event.id="book-detail";clearInterval(core.interval.tipAnimate);core.clearMap("data",0,0,416,416);core.setOpacity("data",1);c=core.splitLines("data",
c,358,"16px Verdana");var d=406-Math.min(416-24*(c.length+1)-65,250),g=(416-d)/2;core.setAlpha("data",.9);core.fillRect("data",10,g,396,d,"#000000");core.setAlpha("data",1);core.strokeRect("data",9,g-1,397,d+1,"#FFFFFF",2);core.canvas.data.textAlign="left";core.fillText("data",a.name,35,g+30,"#FFD700","bold 22px Verdana");for(var e=g+57,b=0;b<c.length;b++){var f=c[b];a=f.indexOf("\uff1a");if(0<=a){var h=f.substring(0,a+1);core.fillText("data",h,35,e,"#FF6A6A","bold 16px Verdana");h=core.canvas.data.measureText(h).width;
core.fillText("data",f.substring(a+1),35+h,e,"#FFFFFF","16px Verdana")}else core.fillText("data",c[b],35,e,"#FFFFFF","16px Verdana");e+=24}core.fillText("data","<\u70b9\u51fb\u4efb\u610f\u4f4d\u7f6e\u7ee7\u7eed>",270,g+d-13,"#CCCCCC","13px Verdana")}};
ui.prototype.drawFly=function(a){0>a&&(a=0);a>=core.status.hero.flyRange.length&&(a=core.status.hero.flyRange.length-1);core.status.event.data=a;var c=core.status.hero.flyRange[a],d=core.status.maps[c].title;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.canvas.ui.textAlign="center";core.fillText("ui","\u697c\u5c42\u8df3\u8dc3",208,60,"#FFFFFF","bold 28px Verdana");core.fillText("ui","\u8fd4\u56de\u6e38\u620f",208,403,"#FFFFFF",
"bold 15px Verdana");core.fillText("ui",d,356,247,"#FFFFFF","bold 19px Verdana");a<core.status.hero.flyRange.length-1&&core.fillText("ui","\u25b2",356,183,"#FFFFFF","17px Verdana");0<a&&core.fillText("ui","\u25bc",356,311,"#FFFFFF","17px Verdana");core.strokeRect("ui",20,100,273,273,"#FFFFFF",2);this.drawThumbnail(c,"ui",core.status.maps[c].blocks,20,100,273)};
ui.prototype.drawMaps=function(a){core.isset(a)||(a=core.floorIds.indexOf(core.status.floorId));0>a&&(a=0);a>=core.floorIds.length&&(a=core.floorIds.length-1);core.lockControl();core.status.event.id="viewMaps";core.status.event.data=a;a=core.floorIds[a];clearTimeout(core.interval.tipAnimate);core.clearMap("ui",0,0,416,416);core.setAlpha("ui",1);this.drawThumbnail(a,"ui",core.status.maps[a].blocks,0,0,416);core.clearMap("data",0,0,416,416);core.setOpacity("data",.2);core.canvas.data.textAlign="left";
core.setFont("data","16px Arial");a=core.floors[a].title;var c=16+core.canvas.data.measureText(a).width+16;core.fillRect("data",5,5,c,42,"#000");core.setOpacity("data",.5);core.fillText("data",a,21,33,"#fff")};
ui.prototype.drawToolbox=function(a){var c=Object.keys(core.status.hero.items.tools).sort(),d=Object.keys(core.status.hero.items.constants).sort();core.isset(a)||(a=0<c.length?0:0<d.length?100:0);core.status.event.selection=a;a=100>a?c[a]:d[a-100];core.hasItem(a)||(a=null);core.status.event.data=a;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.setFillStyle("ui","#DDDDDD");core.setStrokeStyle("ui","#DDDDDD");core.canvas.ui.lineWidth=
2;core.canvas.ui.strokeWidth=2;core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,130);core.canvas.ui.lineTo(416,130);core.canvas.ui.stroke();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,129);core.canvas.ui.lineTo(0,105);core.canvas.ui.lineTo(72,105);core.canvas.ui.lineTo(102,129);core.canvas.ui.fill();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,290);core.canvas.ui.lineTo(416,290);core.canvas.ui.stroke();core.canvas.ui.beginPath();core.canvas.ui.moveTo(0,289);core.canvas.ui.lineTo(0,
265);core.canvas.ui.lineTo(72,265);core.canvas.ui.lineTo(102,289);core.canvas.ui.fill();core.canvas.ui.textAlign="left";core.fillText("ui","\u6d88\u8017\u9053\u5177",5,124,"#333333","bold 16px Verdana");core.fillText("ui","\u6c38\u4e45\u9053\u5177",5,284);if(core.isset(a)){var g=core.material.items[a];core.fillText("ui",g.name,10,32,"#FFD700","bold 20px Verdana");core.fillText("ui",g.text,10,62,"#FFFFFF","17px Verdana");core.fillText("ui","<\u7ee7\u7eed\u70b9\u51fb\u8be5\u9053\u5177\u5373\u53ef\u8fdb\u884c\u4f7f\u7528>",
10,89,"#CCCCCC","14px Verdana")}core.canvas.ui.textAlign="right";g=core.material.images.items;for(var e=0;e<c.length;e++){var b=c[e],f=core.material.icons.items[b];6>e?(core.canvas.ui.drawImage(g,0,32*f,32,32,16*(4*e+1)+5,149,32,32),core.fillText("ui",core.itemCount(b),16*(4*e+1)+40,182,"#FFFFFF","bold 14px Verdana"),a==b&&core.strokeRect("ui",16*(4*e+1)+1,145,40,40,"#FFD700")):(core.canvas.ui.drawImage(g,0,32*f,32,32,16*(4*(e-6)+1)+5,213,32,32),core.fillText("ui",core.itemCount(b),16*(4*(e-6)+1)+
40,246,"#FFFFFF","bold 14px Verdana"),a==b&&core.strokeRect("ui",16*(4*(e-6)+1)+1,209,40,40,"#FFD700"))}for(e=0;e<d.length;e++)c=d[e],f=core.material.icons.items[c],6>e?(core.canvas.ui.drawImage(g,0,32*f,32,32,16*(4*e+1)+5,309,32,32),a==c&&core.strokeRect("ui",16*(4*e+1)+1,305,40,40,"#FFD700")):(core.canvas.ui.drawImage(g,0,32*f,32,32,16*(4*(e-6)+1)+5,373,32,32),a==c&&core.strokeRect("ui",16*(4*(e-6)+1)+1,369,40,40,"#FFD700"));core.canvas.ui.textAlign="center";core.fillText("ui","\u5220\u9664\u9053\u5177",
370,32,"#DDDDDD","bold 15px Verdana");core.fillText("ui","\u8fd4\u56de\u6e38\u620f",370,403,"#DDDDDD","bold 15px Verdana")};
ui.prototype.drawSLPanel=function(a){core.isset(a)||(a=1);0>a&&(a=0);var c=parseInt(a/10);a%=10;30<=c&&(c=29);5<a&&(a=5);core.status.event.data=10*c+a;core.clearMap("ui",0,0,416,416);core.setAlpha("ui",.85);core.fillRect("ui",0,0,416,416,"#000000");core.setAlpha("ui",1);core.canvas.ui.textAlign="center";for(var d=416/6,g="save"==core.status.event.id?"\u5b58\u6863":"\u8bfb\u6863",e=0;6>e;e++){var b=5*c+e,f=core.getLocalStorage(0==e?"autoSave":"save"+b,null);3>e?(core.fillText("ui",0==e?"\u81ea\u52a8\u5b58\u6863":
g+b,(2*e+1)*d,35,"#FFFFFF","bold 17px Verdana"),core.strokeRect("ui",(2*e+1)*d-58.5,50,117,117,e==a?"#FFD700":"#FFFFFF",e==a?6:2),core.isset(f)&&core.isset(f.floorId)?(this.drawThumbnail(f.floorId,"ui",core.maps.load(f.maps,f.floorId).blocks,(2*e+1)*d-58.5,50,117,f.hero.loc),core.fillText("ui",core.formatDate(new Date(f.time)),(2*e+1)*d,182,"#FFFFFF","10px Verdana")):(core.fillRect("ui",(2*e+1)*d-58.5,50,117,117,"#333333",2),core.fillText("ui","\u7a7a",(2*e+1)*d,117,"#FFFFFF","bold 30px Verdana"))):
(core.fillText("ui",g+b,(2*e-5)*d,230,"#FFFFFF","bold 17px Verdana"),core.strokeRect("ui",(2*e-5)*d-58.5,245,117,117,e==a?"#FFD700":"#FFFFFF",e==a?6:2),core.isset(f)&&core.isset(f.floorId)?(this.drawThumbnail(f.floorId,"ui",core.maps.load(f.maps,f.floorId).blocks,(2*e-5)*d-58.5,245,117,f.hero.loc),core.fillText("ui",core.formatDate(new Date(f.time)),(2*e-5)*d,377,"#FFFFFF","10px Verdana")):(core.fillRect("ui",(2*e-5)*d-58.5,245,117,117,"#333333",2),core.fillText("ui","\u7a7a",(2*e-5)*d,315,"#FFFFFF",
"bold 30px Verdana")))}this.drawPagination(c+1,30)};
ui.prototype.drawThumbnail=function(a,c,d,g,e,b,f){core.clearMap(c,g,e,b,b);for(var h=core.material.icons.terrains[core.floors[a].defaultGround||"ground"],q=core.material.images.terrains,k=b/13,m=0;13>m;m++)for(var t=0;13>t;t++)core.canvas[c].drawImage(q,0,32*h,32,32,g+m*k,e+t*k,k,k);if(core.isset(core.floors[a].png)){h=core.floors[a].png;var n=b/416;"string"==typeof h?core.isset(core.material.images.pngs[h])&&core.canvas.ui.drawImage(core.material.images.pngs[h],g,e,b,b):h instanceof Array&&h.forEach(function(a){if(3==
a.length){var c=parseInt(a[0]),d=parseInt(a[1]);a=a[2];core.isset(c)&&core.isset(d)&&core.isset(core.material.images.pngs[a])&&(c*=32,d*=32,a=core.material.images.pngs[a],core.canvas.ui.drawImage(a,g+c*n,e+d*n,Math.min(b-c*n,n*a.width),Math.min(b-d*n,n*a.height)))}})}a=core.maps.getMapArray(d);for(var l in d)m=d[l],!core.isset(m.event)||core.isset(m.enable)&&!m.enable||("autotile"==m.event.cls?core.drawAutotile(core.canvas.ui,a,m,k,g,e):"none"!=m.event.id&&(h=core.material.icons[m.event.cls][m.event.id],
q=core.material.images[m.event.cls],core.canvas[c].drawImage(q,0,32*h,32,32,g+m.x*k,e+m.y*k,k,k)));core.isset(f)&&(d=core.material.icons.hero[f.direction],l=core.material.icons.hero.height,h=k*l/32,core.canvas[c].drawImage(core.material.images.hero,32*d.stop,d.loc*l,32,l,g+k*f.x,e+k*f.y+k-h,k,h))};
ui.prototype.drawKeyBoard=function(){core.lockControl();core.status.event.id="keyBoard";core.clearMap("ui",0,0,416,416);var a=core.canvas.ui.createPattern(core.material.ground,"repeat");core.fillRect("ui",16,48,384,320,a);core.strokeRect("ui",15,47,385,321,"#FFFFFF",2);core.canvas.ui.textAlign="center";core.fillText("ui","\u865a\u62df\u952e\u76d8",208,83,"#FFD700","bold 22px Verdana");core.setFont("ui","17px Verdana");core.setFillStyle("ui","#FFFFFF");var c=119;["F1 F2 F3 F4 F5 F6 F7 F8 F9 10 11".split(" "),
"1234567890".split(""),"QWERTYUIOP".split(""),"ASDFGHJKL".split(""),"ZXCVBNM".split(""),"-=[]\\;',./`".split(""),"ES TA CA SH CT AL SP BS EN DE".split(" ")].forEach(function(a){for(var d=0;d<a.length;d++)core.fillText("ui",a[d],48+32*d,c);c+=32});core.fillText("ui","\u8fd4\u56de\u6e38\u620f",336,c-3,"#FFFFFF","bold 15px Verdana")};
ui.prototype.drawAbout=function(){core.isPlaying()||(core.status.event={id:null,data:null},core.dom.startPanel.style.display="none");core.lockControl();core.status.event.id="about";core.clearMap("ui",0,0,416,416);core.setAlpha("ui",.85);core.fillRect("ui",48,36,320,344,"#000000");core.setAlpha("ui",1);core.strokeRect("ui",47,35,321,345,"#FFFFFF",2);core.canvas.ui.textAlign="left";core.fillText("ui","HTML5 \u9b54\u5854\u6837\u677f",72,71,"#FFD700","bold 22px Verdana");core.fillText("ui","\u7248\u672c\uff1a "+
core.firstData.version,72,116,"#FFFFFF","bold 17px Verdana");core.fillText("ui","Hello Biugle",72,148)};
ui.prototype.drawHelp=function(){core.drawText(["\t[\u952e\u76d8\u5feb\u6377\u952e\u5217\u8868][CTRL] \u8df3\u8fc7\u5bf9\u8bdd\n[X] \u6253\u5f00/\u5173\u95ed\u602a\u7269\u624b\u518c\n[G] \u6253\u5f00/\u5173\u95ed\u697c\u5c42\u4f20\u9001\u5668\n[A] \u8bfb\u53d6\u81ea\u52a8\u5b58\u6863\uff08\u56de\u9000\uff09\n[S/D] \u6253\u5f00/\u5173\u95ed\u5b58/\u8bfb\u6863\u9875\u9762\n[K] \u6253\u5f00/\u5173\u95ed\u5feb\u6377\u5546\u5e97\u9009\u62e9\u5217\u8868\n[T] \u6253\u5f00/\u5173\u95ed\u5de5\u5177\u680f\n[ESC] \u6253\u5f00/\u5173\u95ed\u7cfb\u7edf\u83dc\u5355\n[E] \u663e\u793a\u5149\u6807\n[H] \u6253\u5f00\u5e2e\u52a9\u9875\u9762\n[R] \u56de\u653e\n[SPACE] \u8f7b\u6309\uff08\u4ec5\u5728\u8f7b\u6309\u5f00\u5173\u6253\u5f00\u65f6\u6709\u6548\uff09\n[1] \u5feb\u6377\u4f7f\u7528\u7834\u5899\u9550\n[2] \u5feb\u6377\u4f7f\u7528\u70b8\u5f39/\u5723\u9524\n[3] \u5feb\u6377\u4f7f\u7528\u4e2d\u5fc3\u5bf9\u79f0\u98de\u884c\u5668","\t[\u9f20\u6807\u64cd\u4f5c]\u70b9\u72b6\u6001\u680f\u4e2d\u56fe\u6807\uff1a \u8fdb\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\n\u70b9\u4efb\u610f\u5757\uff1a \u5bfb\u8def\u5e76\u79fb\u52a8\n\u70b9\u4efb\u610f\u5757\u5e76\u62d6\u52a8\uff1a \u6307\u5b9a\u5bfb\u8def\u8def\u7ebf\n\u5355\u51fb\u52c7\u58eb\uff1a \u8f6c\u5411\n\u53cc\u51fb\u52c7\u58eb\uff1a \u8f7b\u6309\uff08\u4ec5\u5728\u8f7b\u6309\u5f00\u5173\u6253\u5f00\u65f6\u6709\u6548\uff09\n\u957f\u6309\u4efb\u610f\u4f4d\u7f6e\uff1a\u6253\u5f00\u865a\u62df\u952e\u76d8"])};